
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remind Me</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f5f7fa; min-height: 100vh; }
        .container { max-width: 800px; margin-top: 40px; }
        .reminder-card { background: white; border-radius: 10px; padding: 20px; margin: 15px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1); position: relative; }
        .time-badge { background: #007bff; color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.9em; }
        #reminderModal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); display: none; }
        .action-buttons { position: absolute; top: 10px; right: 10px; display: flex; gap: 8px; }
        .edit-btn { background: #28a745; border: none; color: white; padding: 4px 8px; border-radius: 4px; cursor: pointer; }
        .delete-btn { background: #dc3545; border: none; color: white; padding: 4px 8px; border-radius: 4px; cursor: pointer; }
        .modal-actions { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }
        .snooze-btn { background: #ffc107; color: black; }
        .stop-btn { background: #dc3545; color: white; }
        .edit-form-title { margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">Remind Me</h1>
        
        <button class="btn btn-primary mb-4" onclick="showReminderForm()">Add New Reminder</button>

        <div id="reminderForm" style="display: none;">
            <div class="reminder-card">
                <h4 class="edit-form-title" id="formTitle">New Reminder</h4>
                <div class="mb-3">
                    <label class="form-label">Purpose</label>
                    <input type="text" class="form-control" id="purposeInput">
                </div>
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Date & Time</label>
                        <input type="datetime-local" class="form-control" id="datetimeInput">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Timezone</label>
                        <select class="form-select" id="timezoneSelect"></select>
                    </div>
                </div>
                <button class="btn btn-success mt-3" onclick="saveReminder()">Save Reminder</button>
                <button class="btn btn-secondary mt-3 ms-2" onclick="cancelEdit()">Cancel</button>
            </div>
        </div>

        <div id="remindersList"></div>
    </div>

    <!-- Reminder Modal -->
    <div id="reminderModal">
        <div class="modal-content">
            <h3>üîî Reminder!</h3>
            <p id="reminderText"></p>
            <div class="modal-actions">
                <button class="btn snooze-btn" onclick="handleSnooze()">Snooze (5m)</button>
                <button class="btn stop-btn" onclick="handleStop()">Stop</button>
            </div>
        </div>
    </div>

    <audio id="alarmSound">
        <source src="https://assets.mixkit.co/active_storage/sfx/2861/2861-preview.mp3" type="audio/mp3">
    </audio>

    <script>
        let reminders = JSON.parse(localStorage.getItem('reminders')) || [];
        let editingId = null;
        let currentReminder = null;
        const alarmSound = document.getElementById('alarmSound');
        let alarmInterval = null;

        // Initialize timezones
        const timezones = Intl.supportedValuesOf('timeZone');
        const timezoneSelect = document.getElementById('timezoneSelect');
        timezones.forEach(tz => {
            const option = document.createElement('option');
            option.value = tz;
            option.textContent = tz;
            timezoneSelect.appendChild(option);
        });

        // Initialize default timezone to user's local timezone
        timezoneSelect.value = Intl.DateTimeFormat().resolvedOptions().timeZone;

        function showReminderForm() {
            document.getElementById('reminderForm').style.display = 'block';
            editingId = null;
            document.getElementById('formTitle').textContent = "New Reminder";
        }

        function saveReminder() {
            const purpose = document.getElementById('purposeInput').value;
            const datetime = document.getElementById('datetimeInput').value;
            const timezone = document.getElementById('timezoneSelect').value;

            if (!purpose || !datetime) {
                alert('Please fill all fields');
                return;
            }

            // Convert local datetime to UTC with timezone consideration
            const localDate = new Date(datetime);
            const utcDate = new Date(localDate.toLocaleString('en-US', { timeZone: timezone }));
            
            const reminder = {
                id: editingId || Date.now(),
                purpose,
                datetime: utcDate.getTime(),
                timezone,
                notified: false
            };

            if (editingId) {
                const index = reminders.findIndex(r => r.id === editingId);
                reminders[index] = reminder;
            } else {
                reminders.push(reminder);
            }

            localStorage.setItem('reminders', JSON.stringify(reminders));
            updateRemindersList();
            document.getElementById('reminderForm').style.display = 'none';
            resetForm();
        }

        function editReminder(id) {
            const reminder = reminders.find(r => r.id === id);
            if (reminder) {
                editingId = id;
                document.getElementById('purposeInput').value = reminder.purpose;
                
                // Convert UTC time back to local datetime
                const localDate = new Date(reminder.datetime);
                const localDateTime = localDate.toLocaleDateString('en-CA') + 'T' + localDate.toLocaleTimeString('en-GB', { hour12: false }).slice(0,5);
                document.getElementById('datetimeInput').value = localDateTime;
                
                document.getElementById('timezoneSelect').value = reminder.timezone;
                document.getElementById('reminderForm').style.display = 'block';
                document.getElementById('formTitle').textContent = "Edit Reminder";
            }
        }

        function deleteReminder(id) {
            if (confirm('Are you sure you want to delete this reminder?')) {
                reminders = reminders.filter(r => r.id !== id);
                localStorage.setItem('reminders', JSON.stringify(reminders));
                updateRemindersList();
            }
        }

        function updateRemindersList() {
            const list = document.getElementById('remindersList');
            list.innerHTML = '';
            
            reminders.sort((a, b) => a.datetime - b.datetime).forEach(reminder => {
                const reminderDate = new Date(reminder.datetime);
                const card = document.createElement('div');
                card.className = 'reminder-card';
                card.innerHTML = `
                    <div class="action-buttons">
                        <button class="edit-btn" onclick="editReminder(${reminder.id})">‚úèÔ∏è</button>
                        <button class="delete-btn" onclick="deleteReminder(${reminder.id})">üóëÔ∏è</button>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5>${reminder.purpose}</h5>
                            <div class="text-muted">
                                ${reminderDate.toLocaleString('en-US', {
                                    timeZone: reminder.timezone,
                                    dateStyle: 'full',
                                    timeStyle: 'short'
                                })}
                            </div>
                        </div>
                        <div class="time-badge">
                            ${reminder.timezone}
                        </div>
                    </div>
                `;
                list.appendChild(card);
            });
        }

        function checkReminders() {
            const now = Date.now();
            reminders.forEach(reminder => {
                if (!reminder.notified && now >= reminder.datetime) {
                    showReminderNotification(reminder);
                    reminder.notified = true;
                    localStorage.setItem('reminders', JSON.stringify(reminders));
                }
            });
        }

        function showReminderNotification(reminder) {
            currentReminder = reminder;
            const modal = document.getElementById('reminderModal');
            const reminderText = document.getElementById('reminderText');
            reminderText.textContent = `Time for: ${reminder.purpose}`;
            modal.style.display = 'block';
            
            // Play alarm sound
            alarmSound.play();
            alarmInterval = setInterval(() => alarmSound.play(), 2000);
        }

        function handleSnooze() {
            if (currentReminder) {
                currentReminder.datetime = Date.now() + 300000; // 5 minutes
                currentReminder.notified = false;
                localStorage.setItem('reminders', JSON.stringify(reminders));
                closeReminder();
                updateRemindersList();
            }
        }

        function handleStop() {
            if (currentReminder) {
                currentReminder.notified = true;
                localStorage.setItem('reminders', JSON.stringify(reminders));
                closeReminder();
                updateRemindersList();
            }
        }

        function closeReminder() {
            document.getElementById('reminderModal').style.display = 'none';
            alarmSound.pause();
            alarmSound.currentTime = 0;
            clearInterval(alarmInterval);
            currentReminder = null;
        }

        function resetForm() {
            document.getElementById('purposeInput').value = '';
            document.getElementById('datetimeInput').value = '';
            timezoneSelect.value = Intl.DateTimeFormat().resolvedOptions().timeZone;
            editingId = null;
        }

        function cancelEdit() {
            document.getElementById('reminderForm').style.display = 'none';
            resetForm();
        }

        // Initial load
        updateRemindersList();
        // Check reminders every second
        setInterval(checkReminders, 1000);
    </script>
</body>
</html>
